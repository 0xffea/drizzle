#
# Suppress some common (not fatal) errors in system libraries found by valgrind
#

{
  dlopen memory leak
  Memcheck:Leak
  fun:*alloc
  ...
  fun:*dlopen*
  ...
}

{
  dlerror memory leak
  Memcheck:Leak
  fun:*alloc
  ...
  fun:*dlerror*
  ...
}

{
  dlclose memory leak
  Memcheck:Leak
  fun:*alloc
  ...
  fun:*dl_close*
  ...
}


# Masking static allocation issues in InnoDB
{
   InnoDB Unclean Startup
   Memcheck:Cond
   ...
   fun:innobase_start_or_create_for_mysql
   ...
}

{
   InnoDB Unclean Startup
   Memcheck:Leak
   fun:*alloc
   ...
   fun:innobase_start_or_create_for_mysql
   ...
}

{
   InnoDB Unclean Startup
   Memcheck:Cond
   ...
   fun:srv_master_thread
   ...
}

{
   InnoDB Unclean Startup
   Memcheck:Leak
   fun:malloc
   ...
   fun:srv_master_thread
   ...
}

{
   InnoDB allocing out of its internal heap is always confusing to valgrind
   Memcheck:Leak
   ...
   fun:mem_heap_create_block
   ...
}

{
   InnoDB Insert Row
   Memcheck:Cond
   ...
   fun:row_insert_for_mysql
   ...
}
{
   InnoDB Insert Row
   Memcheck:Value8
   ...
   fun:row_insert_for_mysql
   ...
}
{
   InnoDB Insert Row
   Memcheck:Leak
   ...
   fun:row_insert_for_mysql
   ...
}
{
   InnoDB Insert Row
   Memcheck:Param
   ...
   fun:row_insert_for_mysql
   ...
}
{
   InnoDB Insert Row
   Memcheck:Param
   write(buf)
   ...
   fun:row_insert_for_mysql
   ...
}

{
   InnoDB Create Table
   Memcheck:Cond
   ...
   fun:row_create_table_for_mysql
   ...
}
{
   InnoDB Create Table
   Memcheck:Leak
   ...
   fun:row_create_table_for_mysql
   ...
}

{
   InnoDB Drop Table
   Memcheck:Cond
   ...
   fun:row_drop_table_for_mysql
   ...
}
{
   InnoDB Drop Table
   Memcheck:Leak
   ...
   fun:row_drop_table_for_mysql
   ...
}




# Masking Leaks in System Libraries
{
   libnss static allocation
   Memcheck:Leak
   ...
   fun:getpwnam
   ...
}

{
  Static buffer created on gcrypt library initialization. Not a leak.
  Memcheck:Leak
  fun:malloc
  ...
  obj:*libgcrypt.so.*
  fun:_ZL10initializeRN8drizzled6module7ContextE
  ...
}

{
   Static buffer in pcre. Not a leak.
   Memcheck:Leak
   fun:malloc
   fun:pcre_compile2
   ...
}

{
   azflush issue in libazio
   Memcheck:Param
   pwrite64(buf)
   ...
   fun:azflush
   ...
}
{
   azflush issue in libazio
   Memcheck:Cond
   fun:deflate
   ...
   fun:azflush
   ...
}

{
   azclose issue in libazio
   Memcheck:Param
   pwrite64(buf)
   ...
   fun:azclose
   ...
}
{
   azclose issue in libazio
   Memcheck:Cond
   fun:deflate
   ...
   fun:azclose
   ...
}

{
   azwrite_row issue in libazio
   Memcheck:Cond
   fun:memcpy
   ...
   fun:deflate
   fun:azwrite_row
   ...
}
{
   azwrite_row issue in libazio
   Memcheck:Value8
   fun:memcpy
   ...
   fun:deflate
   fun:azwrite_row
   ...
}
{
   azwrite_row issue in libazio
   Memcheck:Value4
   fun:memcpy
   ...
   fun:deflate
   fun:azwrite_row
   ...
}


# Things we don't like in Drizzle

{
   This whole codebase is going away, so suppress this annoyance.
   Memcheck:Cond
   fun:_ZN8drizzledL17construct_optionsEPNS_6memory4RootEPNS_6module6ModuleEPNS_6optionE
   fun:_ZN8drizzledL19test_plugin_optionsEPNS_6memory4RootEPNS_6module6ModuleEPiPPc
   fun:_ZN8drizzledL16plugin_load_listERNS_6module8RegistryEPNS_6memory4RootEPiPPcRKSt3setISsSt4lessISsESaISsEEb
   fun:_ZN8drizzled11plugin_initERNS_6module8RegistryEPiPPcb
   fun:_ZN8drizzled22init_server_componentsERNS_6module8RegistryE
   fun:main
}


# https://bugs.launchpad.net/drizzle/+bug/582486
{
   Bug 582486 - Conditional jump or move depends on uninitialised value
   Memcheck:Value8
   ...
   fun:_ZN8drizzled10mysql_loadEPNS_7SessionEPNS_13file_exchangeEPNS_9TableListERNS_4ListINS_4ItemEEES9_S9_NS_15enum_duplicatesEb
   ...
}
{
   Bug 582486 - Conditional jump or move depends on uninitialised value
   Memcheck:Value4
   ...
   fun:_ZN8drizzled10mysql_loadEPNS_7SessionEPNS_13file_exchangeEPNS_9TableListERNS_4ListINS_4ItemEEES9_S9_NS_15enum_duplicatesEb
   ...
}
{
   Bug 582486 - Conditional jump or move depends on uninitialised value
   Memcheck:Cond
   ...
   fun:_ZN8drizzled10mysql_loadEPNS_7SessionEPNS_13file_exchangeEPNS_9TableListERNS_4ListINS_4ItemEEES9_S9_NS_15enum_duplicatesEb
   ...
}

# https://bugs.launchpad.net/drizzle/+bug/582495
{
   Bug 582495 - Syscall param write(buf) points to uninitialised byte(s)
   Memcheck:Param
   write(buf)
   ...
   fun:_ZN8drizzled8internal8my_writeEiPKhmi
   ...
   fun:_ZN8drizzled8filesortEPNS_7SessionEPNS_5TableEPNS_13st_sort_fieldEjPNS_9optimizer9SqlSelectEmbPm
   ...
}

# https://bugs.launchpad.net/drizzle/+bug/582498
{
   Bug 582498 - Invalid read of size 8
   Memcheck:Addr8
   fun:_Z8hp_panicN8drizzled17ha_panic_functionE
   fun:_ZN10HeapEngineD0Ev
   ...
}
{
   Bug 582498 - Invalid read of size 4
   Memcheck:Addr4
   fun:_Z8hp_panicN8drizzled17ha_panic_functionE
   fun:_ZN10HeapEngineD0Ev
   ...
}

# https://bugs.launchpad.net/drizzle/+bug/582526
{
   Possibly lack of deallocation of a thread
   Memcheck:Leak
   fun:calloc
   ...
   fun:pthread_create*
   fun:_Z34initTransactionLogBackgroundWorkerv
   ...
}

