drop table if exists t1;
set @@session.max_heap_table_size=16*1024*1024;
create temporary table t1 (a int not null, b varchar(400), c int, primary key (a), key (c)) engine=MEMORY comment="testing heaps" block_size=128;
ERROR 42000: Incorrect usage/placement of 'block_size'
create temporary table t1 (a int not null, b int, c varchar(400), primary key (a), key (b)) engine=MEMORY comment="testing heaps" block_size=4;
ERROR 42000: Incorrect usage/placement of 'block_size'
create temporary table t1 (a int not null, b int, c varchar(400), d varchar(400), primary key (a), key (b)) engine=MEMORY comment="testing heaps" block_size=24;
show table status like "t1";
Name	Engine	Version	Row_format	Rows	Avg_row_length	Data_length	Max_data_length	Index_length	Data_free	Auto_increment	Create_time	Update_time	Check_time	Collation	Checksum	Create_options	Comment
t1	MEMORY	0	DEFAULT	0	0	0	0	0	0	0	0	0	0	utf8_general_ci	0		
insert into t1 values (1,1,'012',NULL), (2,2,'0123456789',NULL), (3,3,'012345678901234567890123456789',NULL), (4,4,NULL,'0123456789012345678901234567890123456789012345678901234567890123456789');
select * from t1;
a	b	c	d
1	1	012	NULL
2	2	0123456789	NULL
3	3	012345678901234567890123456789	NULL
4	4	NULL	0123456789012345678901234567890123456789012345678901234567890123456789
delete from t1 where a = 3;
select * from t1;
a	b	c	d
1	1	012	NULL
2	2	0123456789	NULL
4	4	NULL	0123456789012345678901234567890123456789012345678901234567890123456789
insert into t1 values (5,5,NULL,'0123'), (6,6,NULL,'0123');
select * from t1;
a	b	c	d
1	1	012	NULL
2	2	0123456789	NULL
6	6	NULL	0123
5	5	NULL	0123
4	4	NULL	0123456789012345678901234567890123456789012345678901234567890123456789
update t1 set c = '012345678901234567890123456789' where a = 2;
select * from t1;
a	b	c	d
1	1	012	NULL
2	2	012345678901234567890123456789	NULL
6	6	NULL	0123
5	5	NULL	0123
4	4	NULL	0123456789012345678901234567890123456789012345678901234567890123456789
update t1 set c = '0123456789' where a = 2;
select * from t1;
a	b	c	d
1	1	012	NULL
2	2	0123456789	NULL
6	6	NULL	0123
5	5	NULL	0123
4	4	NULL	0123456789012345678901234567890123456789012345678901234567890123456789
insert into t1 values (7,7,'0123',NULL), (8,8,'0123',NULL);
select * from t1;
a	b	c	d
1	1	012	NULL
2	2	0123456789	NULL
6	6	NULL	0123
5	5	NULL	0123
4	4	NULL	0123456789012345678901234567890123456789012345678901234567890123456789
7	7	0123	NULL
8	8	0123	NULL
show table status like "t1";
Name	Engine	Version	Row_format	Rows	Avg_row_length	Data_length	Max_data_length	Index_length	Data_free	Auto_increment	Create_time	Update_time	Check_time	Collation	Checksum	Create_options	Comment
t1	MEMORY	0	DEFAULT	0	0	0	0	0	0	0	0	0	0	utf8_general_ci	0		
alter table t1 block_size = 0;
show table status like "t1";
Name	Engine	Version	Row_format	Rows	Avg_row_length	Data_length	Max_data_length	Index_length	Data_free	Auto_increment	Create_time	Update_time	Check_time	Collation	Checksum	Create_options	Comment
t1	MEMORY	0	DEFAULT	0	0	0	0	0	0	0	0	0	0	utf8_general_ci	0		
alter table t1 row_format = dynamic;
show table status like "t1";
Name	Engine	Version	Row_format	Rows	Avg_row_length	Data_length	Max_data_length	Index_length	Data_free	Auto_increment	Create_time	Update_time	Check_time	Collation	Checksum	Create_options	Comment
t1	MEMORY	0	DYNAMIC	0	0	0	0	0	0	0	0	0	0	utf8_general_ci	0		
alter table t1 block_size = 128;
show table status like "t1";
Name	Engine	Version	Row_format	Rows	Avg_row_length	Data_length	Max_data_length	Index_length	Data_free	Auto_increment	Create_time	Update_time	Check_time	Collation	Checksum	Create_options	Comment
t1	MEMORY	0	DYNAMIC	0	0	0	0	0	0	0	0	0	0	utf8_general_ci	0		
select * from t1;
a	b	c	d
1	1	012	NULL
2	2	0123456789	NULL
6	6	NULL	0123
5	5	NULL	0123
4	4	NULL	0123456789012345678901234567890123456789012345678901234567890123456789
7	7	0123	NULL
8	8	0123	NULL
delete from t1;
select * from t1;
a	b	c	d
select count(*) from t1;
count(*)
10001
insert into t1 values (100000,100000,NULL,'0123'), (100000,100000,NULL,'0123');
ERROR 23000: Duplicate entry '100000' for key 'PRIMARY'
show table status like "t1";
Name	Engine	Version	Row_format	Rows	Avg_row_length	Data_length	Max_data_length	Index_length	Data_free	Auto_increment	Create_time	Update_time	Check_time	Collation	Checksum	Create_options	Comment
t1	MEMORY	0	DYNAMIC	0	0	0	0	0	0	0	0	0	0	utf8_general_ci	0		
select count(*) from t1;
count(*)
10002
set @@session.max_heap_table_size=default;
drop table t1;
