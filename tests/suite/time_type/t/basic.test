#
# testing of the TIME column type
#

--disable_warnings
drop table if exists t1;
--enable_warnings

create table t1 (t time);
insert into t1 values ("10:22:33");
insert into t1 values ("12:34:56.78");

--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values (10);

--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values (1234);

insert into t1 values (123456.78);

--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values (1234559.99);

insert into t1 values ("1");

insert into t1 values ("1:23");

insert into t1 values ("1:23:45");

insert into t1 values ("10.22");

--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values ("20 10:22:33");

--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values ("-10  1:22:33.45");

--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values ("1999-02-03 20:33:34");

--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert t1 values (30);
insert t1 values (1230);
insert t1 values ("1230");
insert t1 values ("12:30");
insert t1 values ("12:30:35");
--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert t1 values ("1 12:30:31.32");

select * from t1;
# Test wrong values
--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values ("10.22.22");

--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values (1234567);

--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values (123456789);

--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values (123456789.10);

--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values ("10 22:22");

--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values ("12.45a");
select * from t1;
drop table t1;

create table t1 (t time);
insert into t1 values ('09:00:00');
insert into t1 values ('13:00:00');
insert into t1 values ('19:38:34');
insert into t1 values ('13:00:00');
insert into t1 values ('09:00:00');
insert into t1 values ('09:00:00');
insert into t1 values ('13:00:00');
insert into t1 values ('13:00:00');
insert into t1 values ('13:00:00');
insert into t1 values ('09:00:00');

--error ER_SP_DOES_NOT_EXIST
select t, time_to_sec(t),sec_to_time(time_to_sec(t)) from t1;

--error ER_SP_DOES_NOT_EXIST
select sec_to_time(time_to_sec(t)) from t1;

drop table t1;

#
# BUG #12440: Incorrect processing of time values containing
# long fraction part and/or large exponent part.
#
# These must return normal result:
# ##########################################################
# To be uncommented after fix BUG #15805
# ##########################################################
# SELECT CAST(235959.123456 AS TIME);
# SELECT CAST(0.235959123456e+6 AS TIME);
# SELECT CAST(235959123456e-6 AS TIME);
# These must cut fraction part and produce warning:
# SELECT CAST(235959.1234567 AS TIME);
# SELECT CAST(0.2359591234567e6 AS TIME);
# This must return NULL and produce warning:
# SELECT CAST(0.2359591234567e+30 AS TIME);
# ##########################################################

# End of 4.1 tests

#
# Bug#29555: Comparing time values as strings may lead to a wrong result.
#
select cast('100:55:50' as time) < cast('24:00:00' as time);

select cast('100:55:50' as time) < cast('024:00:00' as time);

select cast('300:55:50' as time) < cast('240:00:00' as time);

select cast('100:55:50' as time) > cast('24:00:00' as time);

select cast('100:55:50' as time) > cast('024:00:00' as time);

select cast('300:55:50' as time) > cast('240:00:00' as time);

create table t1 (f1 time);
--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values ('24:00:00');

select cast('24:00:00' as time) = (select f1 from t1);

drop table t1;

#
# Bug#29739: Incorrect time comparison in BETWEEN.
#
create table t1(f1 time, f2 time);
--error ER_INVALID_UNIX_TIMESTAMP_VALUE
insert into t1 values('20:00:00','150:00:00');

select 1 from t1 where cast('100:00:00' as time) between f1 and f2;

drop table t1;

#
# Bug#29729: Wrong conversion error led to an empty result set.
#
CREATE TABLE  t1 (
  f2 date NOT NULL,
  f3 int NOT NULL default '0',
  PRIMARY KEY  (f3, f2)
);
INSERT INTO t1 VALUES ('2007-07-01', 1);
INSERT INTO t1 VALUES ('2007-07-01', 2);
INSERT INTO t1 VALUES ('2007-07-02', 1);
INSERT INTO t1 VALUES ('2007-07-02', 2);
SELECT sum(f3) FROM t1 WHERE f2='2007-07-01 00:00:00' group by f2;

drop table t1;
