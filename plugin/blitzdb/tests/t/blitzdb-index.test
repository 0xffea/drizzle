# Test Routine for Indexing in BlitzDB

--disable_warnings
drop table if exists t1, t2;
--enable_warnings

create table t1 (id int primary key, a int, b int) engine = blitzdb;
insert into t1 values (1, 1, 1), (2, 2, 2), (3, 3, 3), (4, 4, 4);
insert into t1 values (5, 5, 5), (6, 6, 6), (7, 7, 7), (8, 8, 8);

# Test Duplicate Primary Key Insertions
--error 1062
insert into t1 values (1, 0, 0);
--error 1062
insert into t1 values (2, 0, 0);
--error 1062
insert into t1 values (3, 0, 0);
--error 1062
insert into t1 values (4, 0, 0);

# Test Needle in a Haystack query
select * from t1 where id = 2;
select * from t1 where id = 4;
select * from t1 where id = 6;

# Test Primary Key based Deletion
delete from t1 where id = 5;
delete from t1 where id = 6;
delete from t1 where id = 7;
delete from t1 where id = 8;
select * from t1;
drop table t1;

# Test Auto Increment on PK
create table t1 (id int primary key auto_increment, num int) engine = blitzdb;
insert into t1 (num) values (1);
insert into t1 (num) values (1);
insert into t1 (num) values (1);
insert into t1 (num) values (1);
flush table t1;
insert into t1 (num) values (1);
insert into t1 (num) values (1);
insert into t1 (num) values (1);
insert into t1 (num) values (1);
select * from t1;
drop table t1;

# Test VARCHAR field as a Primary Key
create table t1 (id varchar(64) primary key, country varchar(64)) engine = blitzdb;
insert into t1 values ('amsterdam', 'netherlands');
insert into t1 values ('budapest', 'hungary');
insert into t1 values ('copenhagen', 'denmark');
insert into t1 values ('dublin', 'ireland');
insert into t1 values ('edinburgh', 'scotland');
insert into t1 values ('fukuoka', 'japan');
insert into t1 values ('geneva', 'switzerland');

select * from t1;
select country from t1 where id = 'dublin';
select country from t1 where id = 'geneva';
select country from t1 where id = 'amsterdam';
select country from t1 where id = 'non existent key';
select country from t1 where id = 'edinburgh';
select country from t1 where id = 'copenhagen';
select country from t1 where id = 'fukuoka';
select country from t1 where id = 'budapest';
delete from t1 where id = 'geneva';
delete from t1 where id = 'fukuoka';
select * from t1;
drop table t1;
